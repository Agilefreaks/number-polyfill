// Generated by CoffeeScript 1.6.3
/*
HTML5 Number polyfill | Jonathan Stipe | https://github.com/jonstipe/number-polyfill
*/


(function() {
  (function($) {
    var i, numberPolyfill;
    i = document.createElement("input");
    i.setAttribute("type", "number");
    if (i.type === "text") {
      $.fn.inputNumber = function() {
        console.log("found " + ($(this).filter('input[type="number"]').length) + " elements.");
        $(this).filter('input[type="number"]').each(function() {
          console.log("Creating new polyfill.");
          numberPolyfill.polyfills.push(new numberPolyfill(this));
        });
        return $(this);
      };
      numberPolyfill = function(elem) {
        var $btnContainer, $fieldContainer, attrMutationCallback, attrObserver, domMouseScrollHandler, halfHeight, mouseWheelHandler,
          _this = this;
        this.elem = $(elem);
        halfHeight = (this.elem.outerHeight() / 2) + 'px';
        this.upBtn = $('<div/>', {
          "class": 'number-spin-btn number-spin-btn-up',
          style: "height: " + halfHeight
        });
        this.downBtn = $('<div/>', {
          "class": 'number-spin-btn number-spin-btn-down',
          style: "height: " + halfHeight
        });
        $btnContainer = $('<div/>', {
          "class": 'number-spin-btn-container'
        });
        $fieldContainer = $('<span/>', {
          style: "white-space: nowrap"
        });
        this.upBtn.appendTo($btnContainer);
        this.downBtn.appendTo($btnContainer);
        this.elem.wrap($fieldContainer);
        $btnContainer.insertAfter(this.elem);
        console.log("Added buttons.");
        domMouseScrollHandler = function(e) {
          e.preventDefault();
          if (e.originalEvent.detail < 0) {
            _this.increment();
          } else {
            _this.decrement();
          }
        };
        mouseWheelHandler = function(e) {
          e.preventDefault();
          if (e.originalEvent.wheelDelta > 0) {
            _this.increment();
          } else {
            _this.decrement();
          }
        };
        console.log("Adding element event handlers.");
        this.elem.on({
          focus: function(e) {
            _this.elem.on({
              DOMMouseScroll: domMouseScrollHandler,
              mousewheel: mouseWheelHandler
            });
          },
          blur: function(e) {
            _this.elem.off({
              DOMMouseScroll: domMouseScrollHandler,
              mousewheel: mouseWheelHandler
            });
          },
          keypress: function(e) {
            var _ref, _ref1;
            if (e.keyCode === 38) {
              _this.increment();
            } else if (e.keyCode === 40) {
              _this.decrement();
            } else if (((_ref = e.keyCode) !== 8 && _ref !== 9 && _ref !== 35 && _ref !== 36 && _ref !== 37 && _ref !== 39) && ((_ref1 = e.which) !== 45 && _ref1 !== 46 && _ref1 !== 48 && _ref1 !== 49 && _ref1 !== 50 && _ref1 !== 51 && _ref1 !== 52 && _ref1 !== 53 && _ref1 !== 54 && _ref1 !== 55 && _ref1 !== 56 && _ref1 !== 57)) {
              e.preventDefault();
            }
          },
          change: function(e) {
            var newVal, params;
            if (e.originalEvent != null) {
              params = _this.getParams();
              newVal = _this.clipValues(params['val'], params['min'], params['max']);
              newVal = _this.matchStep(newVal, params['min'], params['max'], params['step'], params['stepDecimal']);
              _this.elem.val(newVal);
            }
          }
        });
        console.log("Adding button event handlers.");
        this.upBtn.on("mousedown", function(e) {
          var releaseFunc, timeoutFunc;
          _this.increment();
          timeoutFunc = function(incFunc) {
            _this.increment();
            _this.timeoutID = window.setTimeout(timeoutFunc, 10);
          };
          releaseFunc = function(e) {
            window.clearTimeout(_this.timeoutID);
            $(document).off('mouseup', releaseFunc);
            _this.upBtn.off('mouseleave', releaseFunc);
          };
          $(document).on('mouseup', releaseFunc);
          _this.upBtn.on('mouseleave', releaseFunc);
          _this.timeoutID = window.setTimeout(timeoutFunc, 700);
        });
        this.downBtn.on("mousedown", function(e) {
          var releaseFunc, timeoutFunc;
          _this.decrement();
          timeoutFunc = function(decFunc) {
            _this.decrement();
            _this.timeoutID = window.setTimeout(timeoutFunc, 10);
          };
          releaseFunc = function(e) {
            window.clearTimeout(_this.timeoutID);
            $(document).off('mouseup', releaseFunc);
            _this.downBtn.off('mouseleave', releaseFunc);
          };
          $(document).on('mouseup', releaseFunc);
          _this.downBtn.on('mouseleave', releaseFunc);
          _this.timeoutID = window.setTimeout(timeoutFunc, 700);
        });
        this.elem.css("textAlign", 'right');
        if (this.elem.css("opacity") !== "1") {
          $btnContainer.css("opacity", this.elem.css("opacity"));
        }
        if (this.elem.css("visibility") !== "visible") {
          $btnContainer.css("visibility", this.elem.css("visibility"));
        }
        console.log("Adding mutation observers.");
        if ((typeof WebKitMutationObserver !== "undefined" && WebKitMutationObserver !== null) || (typeof MutationObserver !== "undefined" && MutationObserver !== null)) {
          attrMutationCallback = function(mutations, observer) {
            var mutation, _i, _len;
            for (_i = 0, _len = mutations.length; _i < _len; _i++) {
              mutation = mutations[_i];
              if (mutation.type === "attributes") {
                if (mutation.attributeName === "class") {
                  $btnContainer.removeClass(mutation.oldValue).addClass(_this.elem.className);
                } else if (mutation.attributeName === "style") {
                  $btnContainer.css({
                    "opacity": _this.elem.css("opacity"),
                    "visibility": _this.elem.css("visibility"),
                    "display": _this.elem.css("display")
                  });
                }
              }
            }
          };
          attrObserver = (typeof WebKitMutationObserver !== "undefined" && WebKitMutationObserver !== null) ? new WebKitMutationObserver(attrMutationCallback) : ((typeof MutationObserver !== "undefined" && MutationObserver !== null) ? new MutationObserver(attrMutationCallback) : null);
          attrObserver.observe(elem, {
            attributes: true,
            attributeOldValue: true,
            attributeFilter: ["class", "style"]
          });
        } else if (typeof MutationEvent !== "undefined" && MutationEvent !== null) {
          this.elem.on("DOMAttrModified", function(evt) {
            if (evt.originalEvent.attrName === "class") {
              $(btnContainer).removeClass(evt.originalEvent.prevValue).addClass(evt.originalEvent.newValue);
            } else if (evt.originalEvent.attrName === "style") {
              $(btnContainer).css({
                "display": elem.style.display,
                "visibility": elem.style.visibility,
                "opacity": elem.style.opacity
              });
            }
          });
        }
        console.log("Done with one.");
      };
      numberPolyfill.polyfills = [];
      numberPolyfill.prototype.getParams = function() {
        var max, min, step, val;
        step = this.elem.attr('step');
        min = this.elem.attr('min');
        max = this.elem.attr('max');
        val = this.elem.val();
        if (!/^-?\d+(?:\.\d+)?$/.test(step)) {
          step = null;
        }
        if (!/^-?\d+(?:\.\d+)?$/.test(min)) {
          min = null;
        }
        if (!/^-?\d+(?:\.\d+)?$/.test(max)) {
          max = null;
        }
        if (!/^-?\d+(?:\.\d+)?$/.test(val)) {
          val = min || 0;
        }
        return {
          min: min,
          max: max,
          step: step,
          val: val
        };
      };
      numberPolyfill.prototype.clipValues = function(value, min, max) {
        if ((max != null) && value > max) {
          return max;
        } else if ((min != null) && value < min) {
          return min;
        } else {
          return value;
        }
      };
      numberPolyfill.extractNumDecimalDigits = function(value) {
        var isFloat, isInt;
        isFloat = /^-?\d+\.\d+$/;
        isInt = /^-?\d+$/;
        if (isFloat.test(value)) {
          return /^-?\d+\.(\d+)$/.exec(value)[1].length;
        } else if (isInt.test(value)) {
          return 0;
        }
      };
      numberPolyfill.prototype.stepNormalize = function(value) {
        return value;
      };
      numberPolyfill.addAsStr = function(str1, str2) {
        var add, carry, digit, digit1, digit2, isFloat, isInt, isNegative, k, output, precision1, precision2, _i, _j, _ref, _ref1;
        isFloat = /^-?\d+(?:\.\d+)?$/;
        isInt = /^-?\d+$/;
        isNegative = /^-.+$/;
        if (isFloat.test(str1) && isFloat.test(str2)) {
          if (isInt.test(str1)) {
            if (isInt.test(str2)) {
              return (parseInt(str1, 10) + parseInt(str2, 10)).toString();
            } else {
              return numberPolyfill.addAsStr(str1 + ".0", str2);
            }
          } else {
            if (isInt.test(str2)) {
              return numberPolyfill.addAsStr(str1, str2 + ".0");
            } else {
              precision1 = str1.length - str1.indexOf(".") - 1;
              precision2 = str2.length - str2.indexOf(".") - 1;
              add = true;
              output = "";
              k = 0;
              carry = 0;
              digit = 0;
              if (precision1 < precision2) {
                for (i = _i = 0, _ref = precision2 - precision1; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
                  str1 = str1 + "0";
                }
              } else if (precision2 < precision1) {
                for (i = _j = 0, _ref1 = precision1 - precision2; 0 <= _ref1 ? _j < _ref1 : _j > _ref1; i = 0 <= _ref1 ? ++_j : --_j) {
                  str2 = str2 + "0";
                }
              }
              if ((isNegative.test(str1) && !isNegative.test(str2)) || (!isNegative.test(str1) && isNegative.test(str2))) {
                add = false;
              }
              while ((k < str1.length && k < str2.length) || carry !== 0) {
                digit1 = k < str1.length ? str1[(str1.length - 1) - k] : "0";
                digit2 = k < str2.length ? str2[(str2.length - 1) - k] : "0";
                if (digit1 === "-") {
                  digit1 = "0";
                }
                if (digit2 === "-") {
                  digit2 = "0";
                }
                if (digit1 === "." && digit2 === ".") {
                  output = "." + output;
                } else {
                  digit1 = parseInt(digit1, 10);
                  digit2 = parseInt(digit2, 10);
                  if (add) {
                    digit = digit1 + digit2 + carry;
                  } else {
                    digit = digit1 - digit2 - carry;
                  }
                  carry = Math.floor(digit / 10);
                  output = (digit % 10).toString() + output;
                }
                k++;
              }
              if (isNegative.test(str1)) {
                if (isNegative.test(str2) || (parseInt(str2, 10) < Math.abs(parseInt(str1, 10)))) {
                  output = "-" + output;
                }
              } else {
                if (isNegative.test(str2) && (Math.abs(parseInt(str2, 10)) > parseInt(str1, 10))) {
                  output = "-" + output;
                }
              }
              return output;
            }
          }
        }
      };
      numberPolyfill.subtractAsStr = function(str1, str2) {
        var isNegative;
        isNegative = /^-.+$/;
        if (isNegative.test(str2)) {
          return numberPolyfill.addAsStr(str1, str2.slice(1));
        } else {
          return numberPolyfill.addAsStr(str1, "-" + str2);
        }
      };
      numberPolyfill.prototype.increment = function() {
        var newVal, params;
        if (!this.elem.is(":disabled")) {
          console.log("increment() called.");
          params = this.getParams();
          newVal = numberPolyfill.addAsStr(params['val'], params['step']);
          if ((params['max'] != null) && parseFloat(newVal) > parseFloat(params['max'])) {
            newVal = params['max'];
          }
          newVal = this.stepNormalize(newVal);
          this.elem.val(newVal).change();
        }
      };
      numberPolyfill.prototype.decrement = function() {
        var newVal, params;
        if (!this.elem.is(":disabled")) {
          console.log("decrement() called.");
          params = this.getParams();
          newVal = numberPolyfill.subtractAsStr(params['val'], params['step']);
          if ((params['min'] != null) && parseFloat(newVal) < parseFloat(params['min'])) {
            newVal = params['min'];
          }
          newVal = this.stepNormalize(newVal);
          this.elem.val(newVal).change();
        }
      };
    } else {
      $.fn.inputNumber = function() {
        return $(this);
      };
      return;
    }
    $(function() {
      $('input[type="number"]').inputNumber();
    });
  })(jQuery);

}).call(this);
